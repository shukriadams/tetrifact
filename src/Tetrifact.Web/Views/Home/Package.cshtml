@using Tetrifact.Core;
@using Tetrifact.Web;
@{
    Layout = "~/Views/Shared/Layout.cshtml";
    PackagePageModel pagemodel = ViewData["pageModel"] as PackagePageModel;
    ViewData["Title"] = $"Package : {pagemodel.PackageId}";
}

<input type="hidden" class="packageId" value="@pagemodel.PackageId" />

<div class="layout-section layout-table">

    <div class="layout-row">
        <div class="layout-label">
        </div>
        <!-- fetched in brownser, see /wwwroot/scripts/package.js -->
        <div class="layout-value" data-archiveStatus>
            Fetching downloading status ...
        </div>
    </div>

    <div class="layout-row">
        <div class="layout-label">
            Created
        </div>
        <div class="layout-value">
            @pagemodel.Manifest.CreatedUtc.ToIso()<span class="subtext"> (@pagemodel.Manifest.CreatedUtc.Ago() ago)</span>
        </div>
    </div>

    <div class="layout-row">
        <div class="layout-label">
            Archive status
        </div>
        <div class="layout-value">
            @if (pagemodel.ArchiveGenerationStatus.State == PackageArchiveCreationStates.Processed_ArchiveAvailable)
            {
                <text>Archive ready</text>               
            }
            else if (pagemodel.ArchiveGenerationStatus.State == PackageArchiveCreationStates.ArchiveGenerating)
            {
                <text>Archive generating (refresh page for update)</text>
            }
            else 
            {
                <text>Archive not generated</text>
            }
        </div>
    </div>

    <div class="layout-row">
        <div class="layout-label">
            File count
        </div>
        <div class="layout-value">
            @pagemodel.Manifest.Files.Count
        </div>
    </div>

    <div class="layout-row">
        <div class="layout-label">
            Size
        </div>
        <div class="layout-value">
            @String.Format("{0:n0}", pagemodel.Manifest.Size) bytes
        </div>
    </div>

    <div class="layout-row">
        <div class="layout-label">
            Size on disk
        </div>
        <div class="layout-value">
            @String.Format("{0:n0}", pagemodel.Manifest.SizeOnDisk) bytes
        </div>
    </div>

    <div class="layout-row">
        <div class="layout-label">
            Hash
        </div>
        <div class="layout-value">
            @pagemodel.Manifest.Hash
        </div>
    </div>

    <div class="layout-row">
        <div class="layout-label">
            Info
        </div>
        <div class="layout-value">
            <a href="/v1/packages/@ViewData["packageId"]">Manifest</a>
        </div>
    </div>

    <div class="layout-row">
        <div class="layout-label">
            Functions
        </div>
        <div class="layout-value">
            <a href="/v1/packages/@ViewData["packageId"]/verify">Verify</a>
            <a href="javascript:void(0);" class="package-removePackage">Delete</a>
        </div>
    </div>

</div>

<div class="layout-section">
    <h2>Tags</h2>
    <div>

        <input class="newTag" type="text" placeholder="New tag" />
        <button class="button addTag">Add</button>

        <div>
            @if (pagemodel.Manifest.Tags.Any())
            {
                <ul>
                    @foreach (string tag in pagemodel.Manifest.Tags.OrderBy(t => t))
                    {
                        <li class="listItem">
                            <a class="package-removeTag" data-tag="@tag" href="javascript:void(null)">
                                <img class="package-deleteIcon" src="/icons/delete.svg" alt="Delete">
                            </a>
                            <a href="/packagesWithTag/@Uri.EscapeDataString(tag)">@tag</a>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p>
                    This package is untagged.
                </p>
            }
        </div>
    </div>
</div>

<div class="layout-section">
    <div>
        <h2>Files</h2>
        <a id="manifestFiles"></a>
        @if (pagemodel.FilesPage.Items.Any())
        {
            <div>

                <ul>
                    @foreach (ManifestItem file in pagemodel.FilesPage.Items)
                    {
                        <li class="listItem">
                            <a class="listItem-icon package-download" href="/v1/files/@file.Id">&#10515;</a>
                            <div class="listItem-text">
                                @file.Path
                            </div>
                        </li>
                    }

                </ul>

                @Html.Raw(pagemodel.Pager)
            </div> 

        } else {
            <text>
                This package contains no files.
            </text>
        }
    </div>
</div>

